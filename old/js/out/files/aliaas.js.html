<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>aliaas.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/AliaasBase.html">AliaasBase</a></li>
            
                <li><a href="..&#x2F;classes/AliaasDevice.html">AliaasDevice</a></li>
            
                <li><a href="..&#x2F;classes/AliaasHome.html">AliaasHome</a></li>
            
                <li><a href="..&#x2F;classes/AliaasRoom.html">AliaasRoom</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: aliaas.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
* Classe de la page principale d&#x27;ALiaaS 
* 
* @class AliaasBase 
* @constructor
**&#x2F;
function AliaasBase() {
  
    &#x2F;**
    * Descripteur de la maison. Ce JSON est mis à jour à chaque fois 
    * que le fichier &quot;house.json&quot; est modifié sur le serveur. Cette 
    * mise à jour est faite par Node.JS côté serveur. 
    *
    * @attribute house
    * @type array
    * @default null
    *&#x2F; 
    this.house = null ; 
    
    &#x2F;**
    * Websocket de SocketIO qui va permettre de se connecter au 
    * serveur Node.JS pour mettre à jour l&#x27;attribut &#x27;house&#x27;.
    *
    * @attribute socket
    * @type socket
    * @default null
    *&#x2F;
    this.socket = null ;
    
    
    &#x2F;**
    * Valeur de la dispersion de la lumière pour le dessin du 
    * cercle d&#x27;incidence des lampes. 
    *
    * @attribute lampGradientValues
    * @type array
    * @default {  0.00 : 1,0.12 : 0.87, 0.25 : 0.48,0.37 : 0.19,0.50 : 0.13, 0.62 : 0.10,0.75 : 0.09,0.87 : 0.07, 0.99 : 0.06, 1 : 0.01 }
    *&#x2F;
    this.lampGradientValues = {  0.00 : 1,0.12 : 0.87, 0.25 : 0.48,0.37 : 0.19,0.50 : 0.13, 
                                 0.62 : 0.10,0.75 : 0.09,0.87 : 0.07, 0.99 : 0.06, 1 : 0.01 };

    &#x2F;**
    * Connect to Node.JS for updating the house. 
    *
    * @method connect
    * @param {string} host Adresse du serveur ou NodeJs est en execution
    * @param {integer} port Port du serveur sur lequel NodeJs est en execution
    * @chainable
    **&#x2F;
    this.connect = function(host, port, updateCallback){
        that = this ; 
        this.socket = io.connect(host, {port:port}); 
        
        this.socket.on(&#x27;house&#x27;, function (data) { 
            if(data != &quot;&quot;) that.house = JSON.parse(data) ; 
            if( updateCallback != undefined ) updateCallback() ;
        }); 
        return this ; 
    }

    &#x2F;**
    * Envoi une commande au proxy.
    * 
    * @method command
    * @chainable
    **&#x2F;
    this.command = function() {
        var device = { address: $(&quot;#address&quot;).val()};
        $.post(&quot;command.php?action=&quot; + $(&quot;#action&quot;).val(), {device: device});
        return this ;
    }

    &#x2F;**
    * Dessin l&#x27;état du système sur le canvas $(&#x27;#roomCanvas&#x27;) à partir de
    * la variable &#x27;house&#x27;.
    * 
    * @method draw
    * @chainable
    **&#x2F;
    this.draw = function () {
        that = this ;
        var ctx = $(&#x27;#roomCanvas&#x27;)[0].getContext(&quot;2d&quot;);
        ctx.clearRect(0, 0, 600, 500);
        $.each(this.house.rooms, function (indiceRoom, room) {
            nb_device = room.devices.length ; 
            $.each(room.devices, function (indiceDevice, device) {
                if (device.state == 1) {  
                    &#x2F;&#x2F;var device_img = new Image ;
                    &#x2F;&#x2F;device_img.src = &quot;.&#x2F;domotique&#x2F;&quot; + device.filename ; 
                    &#x2F;&#x2F;device_img.onload = (function(){ctx.drawImage(device_img, 0, 0);});
                    var gradient = ctx.createRadialGradient(device.x, device.y, 0, device.x, device.y, 100);
                    $.each(that.lampGradientValues, function(i, j){   gradient.addColorStop(i, &#x27;rgba(255,185,15, &#x27;+j+&#x27;)&#x27;); });
                    ctx.fillStyle = gradient;    
                    ctx.arc(device.x, device.y, 200, Math.PI * 2, false);
                    ctx.fill();
                }
            });
        });

        $.each(this.house.rooms, function (indiceRoom, room) {
            $.each(room.devices, function (indiceDevice, device) {
                if (device.state == 1) {
                    var light_bulb_on  = new Image ;
                    light_bulb_on.src  = &quot;images&#x2F;light_on.png&quot; ;
                    light_bulb_on.onload = function(){ctx.drawImage(light_bulb_on, device.x - 16, device.y - 16)};   
                } else { 
                    var light_bulb_off  = new Image ;
                    light_bulb_off.src  = &quot;images&#x2F;light_off.png&quot; ;
                    light_bulb_off.onload = function(){ctx.drawImage(light_bulb_off, device.x - 16, device.y - 16)};       
                }
            });
        });
        return this;
    }
}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
