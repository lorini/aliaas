<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>aliaas.room.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/AliaasBase.html">AliaasBase</a></li>
            
                <li><a href="..&#x2F;classes/AliaasDevice.html">AliaasDevice</a></li>
            
                <li><a href="..&#x2F;classes/AliaasHome.html">AliaasHome</a></li>
            
                <li><a href="..&#x2F;classes/AliaasRoom.html">AliaasRoom</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: aliaas.room.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
* Classe de la page principale d&#x27;ALiaaS 
* 
@class AliaasRoom
@constructor
@extends AliaasBase
**&#x2F;
function AliaasRoom() {
   
    AliaasBase.call(this); 

    &#x2F;**
    * Déformation de horizontale de l&#x27;elipse lors d&#x27;un dessin guidé 
    *
    * @attribute scalex
    * @type integer
    * @default 1
    *&#x2F;
    this.scalex = 1 ; 
 
    &#x2F;**
    * Déformation de verticale de l&#x27;elipse lors d&#x27;un dessin guidé 
    *
    * @attribute scaley
    * @type integer
    * @default 1
    *&#x2F;   
    this.scaley = 1 ; 

    &#x2F;**
    * Lors d&#x27;un dessin guidé et d&#x27;une deformation horizontale, le centre de
    * l&#x27;eclipse se deplace sur l&#x27;axe x pour créer un effet de lampe orienté 
    *
    * @attribute centrex
    * @type integer
    * @default 0
    *&#x2F;
    this.centrex = 0 ; 

    &#x2F;**
    * Angle de rotation de l&#x27;ellipse lors d&#x27;un dessin guidé. 
    *
    * @attribute rotation
    * @type integer
    * @default 0
    *&#x2F;
    this.rotation = 0 ; 

    &#x2F;**
    * Taille de l&#x27;ellipse lors d&#x27;un dessin guidé. 
    *
    * @attribute diffusion
    * @type integer
    * @default 200
    *&#x2F;
    this.diffusion = 200 ; 
    
    &#x2F;**
    * Taille du pinceau lors d&#x27;un dessin libre. 
    *
    * @attribute pencilsize
    * @type integer
    * @default 25
    *&#x2F; 
    this.pencilsize = 25 ;
   
    &#x2F;**
    * Intensité du pinceau lors d&#x27;un dessin libre. 
    *
    * @attribute intensity
    * @type integer
    * @default 10
    *&#x2F;
    this.intensity = 10 ; 

    &#x2F;**
    * Objet globale qui sera envoyé pour l&#x27;ajout d&#x27;une nouvelle lampe
    * et remis à zéro après chaque ajout. 
    *
    * @attribute newDevice
    * @type Object
    * @default Object() 
    *&#x2F; 
    this.newDevice = Object() ; 

    &#x2F;**
    * Flag qui indique que l&#x27;on est en train d&#x27;utiliser le dessin guidé. 
    *
    * @attribute diffusion
    * @type integer
    * @default 1
    *&#x2F; 
    this.guidedRoa  = 1 ;

    &#x2F;**
    * Flag qui indique que l&#x27;on est en train d&#x27;utiliser le dessin libre.   
    *
    * @attribute diffusion
    * @type integer
    * @default 0
    *&#x2F; 
    this.freeRoa    = 0 ; 
   
    &#x2F;**
    * Annule le dessin courant et l&#x27;ajout d&#x27;une nouvelle lampe.
    *
    * @method cancelRoa
    * @chainable
    **&#x2F;
    this.cancelRoa = function (){
        newDevice = Object() ;
        $(&quot;#roaControls&quot;).hide() ;
        $(&quot;#newLamp, #oldLamps&quot;).show(); 
        $(&quot;#roa&quot;).remove() ; 
        return this ; 
    }

    &#x2F;**
    * Envoi la variable this.newDevice au proxy pour l&#x27;ajouter.
    *
    * @method sendNewLamp
    * @chainable
    **&#x2F;
    this.sendNewLamp = function (){
        that = this ;
        this.newDevice.address  = $(&quot;#newDeviceAddress&quot;).val() ;
        this.newDevice.minrange =  0 ; 

        if(this.guidedRoa ==1)  
            this.newDevice.maxrange = $(&quot;#diffusion&quot;).slider(&quot;value&quot;);
        else 
            this.newDevice.maxrange = 0 ; 

        $.post(&quot;command.php?action=add&quot;, { image: $(&quot;#roa&quot;)[0].toDataURL(&quot;image&#x2F;png&quot;) , device: that.newDevice }).success(function(){that.cancelRoa();});
      
        return this;
    }

    &#x2F;**
    * Initialise les sliders qui permettent de régler les paramètres de dessin.
    *
    * @method initSlider
    * @chainable
    **&#x2F;
    this.initSlider = function (){
        that= this ; 
        $(&quot;#rotation&quot;).slider({
            value   :       that.rotation,
            min     :              0,
            max     :            360,
            change  :        function(){that.drawROA()},
            slide   :        function(){that.drawROA()} });

        $(&quot;#diffusion&quot;).slider({
            value   :      that.diffusion,
            min     :              0,
            max     :            300,
            change  :        function(){that.drawROA()},
            slide   :        function(){that.drawROA()}});

        $(&quot;#scalex&quot;).slider({
            value   :            100,
            min     :              1,
            max     :            200,
            change  :        function(){that.drawROA()},
            slide   :        function(){that.drawROA()}});

        $(&quot;#scaley&quot;).slider({
            value   :            100,
            min     :              1,
            max     :            200,
            change  :        function(){that.drawROA()},
            slide   :        function(){that.drawROA()}});

        $(&quot;#pencilsize&quot;).slider({
            value   :     that.pencilsize,
            min     :              0,
            max     :            150,
            slide   : function (event, ui) { that.pencilsize = $(this).slider(&quot;value&quot;); }
        });

        $(&quot;#intensity&quot;).slider({
            value   :      that.intensity,
            min     :              0,
            max     :             40,
            slide   : function (event, ui) { that.intensity = $(this).slider(&quot;value&quot;); }
        });

        return this;
    }

    &#x2F;**
    * Cette méthode permet de dessiner une ROA (Region of action) guidé.
    * Les valeurs utilisées sont celles des sliders. Cette méthode est 
    * appelée à chaque changement de valeurs dans les sliders. 
    *
    * @method drawROA
    * @chainable
    **&#x2F;
    this.drawROA = function () {
        
        this.diffusion   = $(&quot;#diffusion&quot;).slider(&quot;value&quot;);
        this.rotation    = $(&quot;#rotation&quot;).slider(&quot;value&quot;)     ; 
        this.scalex      = $(&quot;#scalex&quot;).slider(&quot;value&quot;) &#x2F; 100 ;
        this.scaley      = $(&quot;#scaley&quot;).slider(&quot;value&quot;) &#x2F; 100 ;
        this.centrex     = (200 - that.scaley * 200);
        this.centrey     = (200 - that.scalex * 200);
       
        var roaContext = $(&#x27;#roa&#x27;)[0].getContext(&quot;2d&quot;);
        roaContext.save();
        roaContext.clearRect(0, 0, 600, 500);
        roaContext.beginPath();
        roaContext.translate(this.newDevice.x, this.newDevice.y);
        roaContext.rotate(that.rotation * Math.PI &#x2F; 180);
        roaContext.scale(that.scalex, that.scaley);
        roaContext.arc(0, 0, that.diffusion, Math.PI * 2 , 0, false);

        var gradient = roaContext.createRadialGradient(this.centrex, 0, 0, this.centrex, 0, this.diffusion);
        $.each(that.lampGradientValues, function(i, j){gradient.addColorStop(i, &#x27;rgba(255,185,15, &#x27;+j+&#x27;)&#x27;); });
        roaContext.fillStyle = gradient ;
        roaContext.fill() ;
        roaContext.restore() ;
    }

    this.initDrawSpace = function (options){
        that = this ;
        function storeRoaPoint(event){

            var roaPoint = { x          : event.offsetX , 
                             y          : event.offsetY , 
                             intensity  : that.intensity     , 
                             pencilsize : that.pencilsize    } ;

            if (roaPoint.intensity &gt; 1)
                roaPoints.push(roaPoint); 
            
            drawRoaPoints(roaPoint); 
        }

        function drawRoaPoints(roaPoint){   
            context.beginPath();
            context.fillStyle = &quot;rgb(255,&quot;+(255- roaPoint.intensity)+&quot;,&quot;+(255-5*roaPoint.intensity)+&quot;)&quot;;
            &#x2F;&#x2F; 0 a 50k
            if (roaPoint.intensity &lt;= 1)
                context.globalCompositeOperation = &#x27;destination-out&#x27; ;
            else 
                context.globalCompositeOperation = &#x27;source-over&#x27;     ;

            context.arc(roaPoint.x, roaPoint.y, roaPoint.pencilsize, 0, Math.PI * 2, true);

             if (roaPoint.intensity &gt; 1){
                $(&quot;#indicationGomme&quot;).html(&quot;&quot;);
                var gradient = context.createRadialGradient(roaPoint.x, 0, 0, roaPoint.x, 0, that.intensity);
                $.each(that.lampGradientValues, function(i, j){gradient.addColorStop(i, &#x27;rgba(255,185,15, &#x27;+j+&#x27;)&#x27;); });
                context.fillStyle = gradient ;
            } else 
                $(&quot;#indicationGomme&quot;).html(&quot;MODE GOMME&quot;) ;

            context.closePath();
            context.fill();    
        }
     
        var $canvas    = $(&quot;&lt;canvas&#x2F;&gt;&quot;).attr(options)
                                       .bind(&quot;mousemove mouseclick mouseenter vclick touch&quot;, storeRoaPoint)
                                       .css(&quot;position&quot;, &quot;absolute&quot;)
                                       .appendTo($(&quot;body&quot;))
                                       .offset(options);

        var roaPoints  = Array(); 
        var context    = $canvas[0].getContext(&quot;2d&quot;);   
    }

    this.initDragNDrop = function (){
        that = this ; 
        $(&quot;.draggable&quot;).draggable({
            cursorAt: {left: 16, top: 16},
            revert  : true 
        });

        $(&quot;#roomCanvas&quot;).droppable({
            drop: function (event, ui) {
                that.newDevice.x = Math.floor(event.pageX - $(this).offset().left) ; 
                that.newDevice.y = Math.floor(event.pageY - $(this).offset().top) ; 
                that.newDevice.moduleName = $(ui.draggable).attr(&quot;id&quot;) ;

                var modalHeader = &quot;Ajout d&#x27;une nouvelle lampe de type &quot;+that.newDevice.moduleName+&quot; aux coordonnées x=&quot;+that.newDevice.x+&quot; y=&quot;+that.newDevice.y ;

                $(&quot;#RoaTypeChoiceModal .modal-header&quot;).find(&quot;h5&quot;).html(modalHeader);

                $(&quot;#RoaTypeChoiceModal&quot;).modal();
            }
        });
    }

    this.initUI = function(){
        that = this ; 
        $(&quot;#RoaTypeChoiceModal&quot;).find(&#x27;.nextBtn&#x27;).click(function(){
            var drawType ; 

            if(that.guidedRoa == 1) {
                drawType = &quot;guidé&quot; ;
                $(&quot;#freeRoaControls&quot;).hide() ; 
                $(&quot;#guidedRoaControls&quot;).show() ; 
            } else {
                drawType = &quot;libre&quot; ;
                $(&quot;#freeRoaControls&quot;).show() ; 
                $(&quot;#guidedRoaControls&quot;).hide() ;
            }

            $(&quot;#roaControls&quot;).find(&quot;h3&quot;).html(&quot;Outils de dessin &quot;+ drawType) ;
            $(&quot;#newLamp, #oldLamps&quot;).hide(); 
            $(&quot;#roaControls&quot;).show();

            $heatmapArea = $(&quot;#heatmapArea&quot;) ;

            if(that.guidedRoa == 1){
                var $roa = $(&quot;&lt;canvas&gt;&lt;&#x2F;canvas&gt;&quot;).attr({ id : &quot;roa&quot;, width : 600 , height : 500 });
                $roa.css({
                    top      : $heatmapArea.position()[&quot;top&quot;], 
                    left     : $heatmapArea.position()[&quot;left&quot;], 
                    position : &quot;absolute&quot;
                });
                $(&quot;body&quot;).append($roa); 
                that.drawROA() ;
            } else {
                that.initDrawSpace({ id : &quot;roa&quot;,  width : 600, height: 500, 
                                top   : $heatmapArea.position()[&quot;top&quot;] +1 , 
                                left  : $heatmapArea.position()[&quot;left&quot;] +1});
            }
        });

        $(&quot;#roaControls&quot;).hide();
        $(&quot;#guidedRoaButton&quot;).click(function(){ that.guidedRoa  = 1 ; that.freeRoa    = 0 ;});
        $(&quot;#freeRoaButton&quot;).click(function(){ that.guidedRoa  = 0 ; that.freeRoa    = 1 ; });
        $(&quot;#cancelRoaButton&quot;).click(function(){that.cancelRoa()}); 
        $(&quot;#validRoaButton&quot;).click(function(){that.sendNewLamp()}); 
        this.initSlider() ;
        this.initDragNDrop() ;
    }
}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
